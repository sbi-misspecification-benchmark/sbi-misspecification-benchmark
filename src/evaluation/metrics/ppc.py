import torch


def compute_ppc(posterior_samples, observation, simulator):
    """
    Compute the posterior predictive check distance by simulating the "observation" from posterior samples
    and comparing it to the real observation

    Args:
        posterior_samples: samples generated by the inference step
        observation: real observation
        simulator: simulator object that maps theta to x

    Returns:
        float: average distance between simulated and real observation
    """

    simulated_x = simulator(posterior_samples)
    # compute the absolute distance between each pair
    distances = torch.abs(simulated_x-observation).mean(dim=1)
    # mean distance across all samples
    return distances.mean().item()